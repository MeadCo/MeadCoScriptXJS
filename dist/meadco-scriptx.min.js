(()=>{(function(topLevelNs){"use strict";void 0===topLevelNs.ScriptX&&(console.log("intialising new ScriptX package"),topLevelNs.ScriptX={});const version="1.10.4";let scriptx=topLevelNs.ScriptX;const enumConnection={NONE:0,ADDON:1,SERVICE:2},enumMeasurementUnits={DEFAULT:0,MM:1,INCHES:2};console.log("Initialising MeadCo.ScriptX: "+version),scriptx.MeasurementUnits=enumMeasurementUnits,scriptx.Connection=enumConnection,scriptx.Factory=null,scriptx.Printing=null,scriptx.Utils=null;let Connector=enumConnection.NONE;const LibVersion=version;scriptx.Connector=enumConnection.NONE,scriptx.LibVersion=version,scriptx.StartAsync=function(n){return new Promise((function(t,i){ifServiceSettingsThenConnect(n).then((function(){MeadCo.Licensing.IsLicensedAsync().then((function(e){MeadCo.ScriptX.InitAsync().then((function(r){try{n&&n.printSettings&&applySettings(n.printSettings),t({license:e,connection:r})}catch(n){console.error("Exception while applying settings: "+n.message),i&&i(n.message)}})).catch((function(n){i&&i(errorMesssage)}))})).catch((function(n){i&&i(n)}))})).catch((function(n){i&&i(n)}))}))},scriptx.Init=function(){return null===scriptx.Printing&&(console.log("scriptx.Init()"),null!==findFactory(!0)?"function"==typeof scriptx.Printing.PolyfillInit?(console.log("found ScriptX.Print Services"),console.warn("Synchronous initialisation is deprecated - please update to MeadCo.ScriptX.InitAsync()."),MeadCo.Licensing.IsLicensed()&&scriptx.Printing.PolyfillInit()?scriptx.Connector=scriptx.Connection.SERVICE:(console.warn("scriptx.Init() licensing or polyfillinit failed."),scriptx.Printing=null,scriptx.Connector=scriptx.Connection.NONE)):scriptx.Connector=scriptx.Connection.ADDON:console.warn("** Warning -- no factory **")),null!==scriptx.Printing},scriptx.InitAsync=function(){let n;return console.log("scriptx.InitAsync()"),null===scriptx.Printing?(console.log("unknown state ..."),n=new Promise((function(n,t){console.log("looking for state ..."),null!==findFactory(!0)?(console.log("look for Polyfill .."),"function"==typeof scriptx.Printing.PolyfillInitAsync?(console.log("found async ScriptX.Print Services"),MeadCo.Licensing.IsLicensedAsync().then((function(){console.log("license is available"),scriptx.Printing.PolyfillInitAsync((function(){scriptx.Connector=scriptx.Connection.SERVICE,console.log("scriptx.InitAsync() calling resolve ..."),n(scriptx.Connector)}),t)})).catch((function(n){t(n)}))):(scriptx.Connector=scriptx.Connection.ADDON,console.log("no polyfill, using add-on"),n(scriptx.Connector))):(console.warn("** Warning -- no factory **"),t&&t("Unable to find a ScriptX 'factory' object."))}))):n=new Promise((function(n,t){n(scriptx.Connector)})),n},scriptx.InitWithVersion=function(n){let t=!1;return scriptx.Init()&&(t=scriptx.IsVersion(n),t||alert("ScriptX v"+n+" or later is required.\nYou are using a previous version and errors may occur.")),t},scriptx.Version=function(){return scriptx.GetComponentVersion("ScriptX.Factory")},scriptx.IsVersion=function(n){return scriptx.IsComponentVersion("ScriptX.Factory",n)},scriptx.IsServices=function(){let n=scriptx.Connector;if(console.log("IsServices() on connector: "+n),n===enumConnection.NONE){let t=findFactory(!1);n=null!==t?"function"==typeof t.PolyfillInit?enumConnection.SERVICE:enumConnection.ADDON:enumConnection.SERVICE}return n===enumConnection.SERVICE},scriptx.ServicesVersion=function(){return scriptx.IsServices()?scriptx.GetComponentVersion("scriptx.services"):""},scriptx.IsServicesVersion=function(n){return!!scriptx.IsServices()&&scriptx.IsComponentVersion("scriptx.services",n)},scriptx.SetContentAuthorisationCookie=function(n){scriptx.IsServices()&&(scriptx.Printing.PolyfillAuthorisationCookie=n)},scriptx.PrintPage=function(n){return!!scriptx.Init()&&scriptx.Printing.Print(n)},scriptx.PrintPage2=function(n){return new Promise((function(t,i){scriptx.Init()?scriptx.Connector===scriptx.Connection.SERVICE?scriptx.Printing.Print(n,null,(function(n){t(n)})):t(scriptx.Printing.Print(n)):i()}))},scriptx.PreviewPage=function(){scriptx.Init()&&scriptx.Printing.Preview()},scriptx.PrintFrame=function(frame,bPrompt){return!!scriptx.Init()&&scriptx.Printing.Print(bPrompt,"string"==typeof frame?scriptx.IsVersion("6.5.439.30")?frame:eval("window."+frame):frame)},scriptx.PrintFrame2=function(n,t){return new Promise((function(i,e){scriptx.Init()?scriptx.Connector===scriptx.Connection.SERVICE?scriptx.Printing.Print(t,n,(function(n){i(n)})):i(scriptx.PrintFrame(n,t)):e()}))},scriptx.PreviewFrame=function(frame){scriptx.Init()&&scriptx.Printing.Preview("string"==typeof frame?scriptx.IsVersion("6.5.439.30")?frame:eval("window."+frame):frame)};let jobIndex=1;function findFactory(n){let t=window.factory||document.getElementById("factory");return t&&void 0!==t.object&&null!==t.object?(n&&(scriptx.Factory=t,scriptx.Utils=t.object,scriptx.Printing=t.printing),console.log("found a scriptx factory"),t.printing):null}function compareVersions(n,t){let i,e=n.split("."),r=t.split(".");if(e.length!==r.length)return!1;for(i=0;i<e.length;i++)e[i]=parseInt(e[i]),r[i]=parseInt(r[i]);return e[0]>r[0]||e[0]>=r[0]&&e[1]>r[1]||e[0]>=r[0]&&e[1]>=r[1]&&e[2]>r[2]||e[0]>=r[0]&&e[1]>=r[1]&&e[2]>=r[2]&&e[3]>=r[3]}function statusUpdate(n,t){console.log("PrintHTML Queue status: "+n+" => "+t)}function progressMonitor(n,t,i){switch(n){case 1:statusUpdate(n,"Request to print has been queued for: "+i+(void 0===t?"":", "+t));break;case 2:statusUpdate(n,"Print job started on: "+i);break;case 3:statusUpdate(n,"Downloading "+t+" for: "+i);break;case 4:statusUpdate(n,"Download completed to "+t+" for: "+i);break;case 5:statusUpdate(n,"Printing has started for: "+i);break;case 6:statusUpdate(n,"Job complete for: "+i);break;case 7:statusUpdate(n,"Job paused for: "+i);break;case 8:statusUpdate(n,"PDF is being printed: "+t+" for: "+i);break;case-1:statusUpdate(n,"Print failed because of an error: ["+t+"] for: "+i);break;case-2:statusUpdate(n,"Printing has been abandoned for: "+i)}}function ifServiceSettingsThenConnect(n){return new Promise((function(t,i){if(n&&n.serviceConnection){let e=n.serviceConnection;MeadCo.ScriptX.Print.Licensing.connect(e.serverUrl,e.licenseGuid),if4WPCLicenseApply(e).then((function(){MeadCo.ScriptX.Print.HTML.connectAsync(e.serverUrl,e.licenseGuid,(function(){t()}),(function(n){i(n)}))})).catch((function(n){i(n)}))}else t()}))}function if4WPCLicenseApply(n){return new Promise((function(t,i){n.licensePath&&void 0!==n.licenseRevision?MeadCo.ScriptX.Print.Licensing.applyAsync(n.licenseGuid,n.licenseRevision,n.licensePath,(function(){t()}),(function(n){i(n)})):t()}))}function applySettings(n){if("object"==typeof n&&("string"==typeof n.header&&(MeadCo.ScriptX.Printing.header=n.header),"string"==typeof n.footer&&(MeadCo.ScriptX.Printing.footer=n.footer),"object"==typeof n.pageSetup)){var t=n.pageSetup;if(void 0!==t.units&&MeadCo.ScriptX.Printing.SetMarginMeasure(t.units),"string"==typeof t.orientation&&(MeadCo.ScriptX.Printing.orientation=t.orientation),"object"==typeof t.margins){var i=t.margins;void 0!==i.left&&(MeadCo.ScriptX.Printing.leftMargin=i.left),void 0!==i.right&&(MeadCo.ScriptX.Printing.rightMargin=i.right),void 0!==i.top&&(MeadCo.ScriptX.Printing.topMargin=i.top),void 0!==i.bottom&&(MeadCo.ScriptX.Printing.bottomMargin=i.bottom)}}}scriptx.BackgroundPrintURL=function(n,t,i,e){return!!scriptx.Init()&&(void 0===i&&(i=progressMonitor),void 0===e&&(e="Job "+jobIndex++),scriptx.Printing.PrintHTMLEx(n,t,i,e))},scriptx.BackgroundPrintURL2=function(n,t,i,e){return new Promise((function(r,o){scriptx.Init()?(void 0===i&&(i=progressMonitor),void 0===e&&(e="Job "+jobIndex++),scriptx.Connector===scriptx.Connection.SERVICE?scriptx.Printing.PrintHTMLEx(n,t,i,e,(function(n){r(n)})):r(scriptx.Printing.PrintHTMLEx(n,t,i,e))):o&&o()}))},scriptx.BackgroundPrintHTML=function(n,t,i){return scriptx.BackgroundPrintURL("html://"+n,!1,t,i)},scriptx.DirectPrintString=function(n,t){if(scriptx.Init()){let i=scriptx.Factory.rawPrinting;i.printer=n,i.printString(t)}},scriptx.DirectPrintDocument=function(n,t){if(scriptx.Init()){var i=scriptx.Factory.rawPrinting;i.printer=n,i.printDocument(scriptx.Factory.baseURL(t))}},scriptx.PageSetup=function(){return!!scriptx.Init()&&scriptx.Printing.PageSetup()},scriptx.PrintSetup=function(){return!!scriptx.Init()&&scriptx.Printing.PrintSetup()},scriptx.PageSetup2=function(){return new Promise((function(n,t){scriptx.Init()?scriptx.Connector===scriptx.Connection.SERVICE?scriptx.Printing.PageSetup((function(i){i?n():t&&t()})):scriptx.Printing.PageSetup()?n():t&&t():t()}))},scriptx.PrintSetup2=function(){return new Promise((function(n,t){scriptx.Init()?scriptx.Connector===scriptx.Connection.SERVICE?scriptx.Printing.PrintSetup((function(i){i?n():t&&t()})):scriptx.Printing.PrintSetup()?n():t&&t():t&&t()}))},scriptx.WaitForSpoolingComplete=function(){return scriptx.Connector===scriptx.Connection.SERVICE?new Promise((function(n,t){scriptx.Printing.WaitForSpoolingComplete(-1,n)})):new Promise((function(n,t){window.setTimeout((function(){n(scriptx.Printing.WaitForSpoolingComplete())}),1)}))},scriptx.CloseWindow=function(n){scriptx.IsServices()?scriptx.Printing.WaitForSpoolingComplete(5e3,(function(){n.close()})):n.close()},scriptx.HasOrientation=function(){return scriptx.IsComponentVersion("ScriptX.Factory","7.0.0.1")},scriptx.GetAvailablePrinters=function(){let n,t=new Array;if(scriptx.Init())try{for(var i=0;(n=scriptx.Printing.EnumPrinters(i)).length>0;i++)t.push(n)}catch(n){}return t},scriptx.GetComponentVersion=function(n){let t=new Object,i=new Object,e=new Object,r=new Object,o="(Not installed)";try{scriptx.Utils.GetComponentVersion(n,t,i,e,r),o=t[0]+"."+i[0]+"."+e[0]+"."+r[0]}catch(n){}return o},scriptx.ScriptXVersion=function(){return scriptx.GetComponentVersion("ScriptX.Factory")},scriptx.SecurityManagerVersion=function(){return scriptx.GetComponentVersion("MeadCo.SecMgr")},scriptx.IsComponentVersion=function(n,t){return compareVersions(scriptx.GetComponentVersion(n),t)}})(window.MeadCo=window.MeadCo||{}),function(n){"use strict";n.Licensing={};let t=n.Licensing;t.Connection={NONE:0,ADDON:1,SERVICE:2},t.LibVersion="1.8.1",t.LicMgr=null,t.Connector=t.Connection.NONE,t.Init=function(){return null===t.LicMgr&&(console.log("licensing.Init()"),r()?"function"==typeof t.LicMgr.PolyfillInit?(console.log("found secmgr services"),console.warn("Synchronous initialisation is deprecated - please update to MeadCo.Licensing.InitAsync()."),t.LicMgr.PolyfillInit()?t.Connector=t.Connection.SERVICE:(console.log("**warning** polyfill failed."),t.LicMgr=null,t.Connector=t.Connection.NONE)):t.Connector=t.Connection.ADDON:console.log("** Warning -- no secmgr **")),null!==t.LicMgr&&void 0!==t.LicMgr.result},t.InitAsync=function(){return console.log("licensing.InitAsync()"),new Promise((function(n,i){null===t.LicMgr?r()?(console.log("Look for polyfill"),"function"==typeof t.LicMgr.PolyfillInitAsync?(console.log("Found async secmgr services"),t.LicMgr.PolyfillInitAsync((function(){console.log("polyfill initialised ok"),t.Connector=t.Connection.SERVICE,n()}),i)):(console.log("No polyfill, using as add-on"),t.Connector=t.Connection.ADDON,n())):(console.log("** Warning -- no secmgr **"),i&&i("ScriptX could not be found - is it installed?")):t.Connector===t.Connection.NONE?i&&i("ScriptX could not be found - is it installed?"):n()}))},t.IsLicensed=function(){return t.Init()?(t.Connector===t.Connection.SERVICE&&t.LicMgr.License,0===t.LicMgr.result&&t.LicMgr.validLicense):(console.warn("WARNING :: MeadCo.Licensing.Init() failed so IsLicensed will return false."),!1)},t.IsLicensedAsync=function(){return new Promise((function(n,i){t.InitAsync().then((function(){"function"==typeof t.LicMgr.GetLicenseAsync?t.LicMgr.GetLicenseAsync(n,i):n(t.LicMgr.License)})).catch((function(){i&&i(e())}))}))},t.ErrorMessage=function(){return console.log("licensing.ErrorMessage - MeadCo Security Manager reports licensed: "+this.IsLicensed()),t.IsLicensed()?"":e()},t.ReportError=function(n){let i=t.ErrorMessage();""!==i&&function(n){let t=n;for(var i=1;i<arguments.length;i++)arguments[i]&&(t+="\n\n"+arguments[i]);alert(t)}(i,n)};let i=new Array("Unable to locate the MeadCo License Manager object - the component may not be installed.","The license for this site is not valid.","The license for this site not installed on this machine.","The license for this site has not been accepted by the user.","There was an error loading the license. ","There was an error in ScriptX.Services license management.");function e(){let n=-1,e="";if(null!==t.LicMgr)switch(console.log("license result: "+t.LicMgr.result+" valid: "+t.LicMgr.validLicense),t.LicMgr.result){case 0:t.LicMgr.validLicense||(n=1);break;case 5:if("string"==typeof t.LicMgr.errorMessage)return t.LicMgr.errorMessage;n=5;break;case 1:n=2;break;case-2147220500:n=3;break;default:n=4,e="\nLicense manager reported error code: 0x"+(4294967296+t.LicMgr.result).toString(16).toUpperCase()}else n=0;return n>=0?i[n]+e:""}function r(){let n=window.secmgr||document.getElementById("secmgr");return!(!n||null===n.object||void 0===n.object)&&(t.LicMgr=n.object,console.log("Found a secmgr: "+(void 0!==t.LicMgr.result)),void 0!==t.LicMgr.result)}}(window.MeadCo=window.MeadCo||{})})();
//# sourceMappingURL=meadco-scriptx.min.js.map